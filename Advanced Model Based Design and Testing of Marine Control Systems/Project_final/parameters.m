
NN=3; %number of models
Ts=0.001;  %%Sample time
%%measurement noise power
TH1=10^-6; 
TH2=10^-6; 
%%plant noise power
XI1=1;     XI2=11;     
%% known parameters
m1=1; m4=1;
m2=1; m3=1;
k1=0.15; k2=1.625; k3=0.1; k4=0.1; k5=1.7;
b1=0.1;  b2=0.1; b3=0.1; b4=0.1; b5 =0.1;

k3_nom=.1; k4_nom=.1;
b3_nom=0.1;  b4_nom =0.1;

% k3_LB=.04; k3_UB=.06;
% k4_LB=.04; k4_UB=.06;
% 
% b3_LB=.004; b3_UB=.006;
% b4_LB=.004; b4_UB=.006;
%%
%OK! used in my thesis, Dec 5, 2005
% alfa1=1;                 %fraequency bandwidth of first order filter making disturbance d1 acting on m2
% alfa2=1;                 %fraequency bandwidth of first order filter making disturbance d2 acting on m3

alfa1=.2;                 %fraequency bandwidth of first order filter making disturbance d1 acting on m2
alfa2=.2;                 %fraequency bandwidth of first order filter making disturbance d2 acting on m3
BWx1=1;                 %fraequency bandwidth of first order performance filter on output x1
BWx4=1;                 %fraequency bandwidth of first order performance filter on output x4

% 
% k1_act=1.5;
% m3_act=1;
% P_tau=[0.01 .01 .01 .01 .96]'; % mismatch model-controller at t=tau (no need here!!)
% 
tau=.01;    %delay used in the simulation
smoother=1;%   1 use a low pass filter on parameter estimated by EKF
           %   2 do not use a low pass filter on parameter estimated by EKF

K2_UBTotal=2.5;
K2_LBTotal=.75;
K5_UBTotal=2.5;
K5_LBTotal=.9;

P1 = [1.08873881502894e-08,1.40024465741269e-10,1.01711473110296e-10,1.36870860724404e-12,5.96646043886554e-08,3.13511653856148e-09,1.18548043644408e-09,1.36839551845763e-11,1.85863403835870e-07,-5.42438216435837e-11;1.40024465741269e-10,4.85827620886898e-09,5.28586973232963e-10,9.84774073153326e-11,-1.60121456607217e-09,9.50129462915317e-12,1.21076284074957e-11,-9.62186332901567e-11,-9.02185456435603e-09,-1.70225955710282e-09;1.01711473110297e-10,5.28586973232962e-10,4.87237508360839e-09,1.05583772148436e-10,-7.21599033230259e-11,1.12638630013424e-11,5.54490305449090e-12,-1.86838723559981e-09,-1.60570718386719e-09,-9.80777214816870e-09;1.36870860724406e-12,9.84774073153335e-11,1.05583772148435e-10,1.67459372386178e-08,2.51899574928187e-11,1.75911864014898e-09,3.65172623936547e-09,1.41682565140493e-07,1.28953635107450e-11,6.28326199878920e-07;5.96646043886554e-08,-1.60121456607216e-09,-7.21599033230274e-11,2.51899574928185e-11,5.10758129118835e-07,7.51751009323915e-09,6.38943616962306e-09,-2.40969935506382e-10,2.08343027094044e-06,2.76402410823026e-10;3.13511653856147e-09,9.50129462915364e-12,1.12638630013418e-11,1.75911864014898e-09,7.51751009323910e-09,1.06975994081968e-08,1.59911760168111e-09,1.44795227500507e-08,2.45136883399521e-08,6.25942734117707e-08;1.18548043644408e-09,1.21076284074965e-11,5.54490305449092e-12,3.65172623936547e-09,6.38943616962307e-09,1.59911760168111e-09,1.07124069990590e-08,1.50160232172832e-08,1.87965649591263e-08,6.55169547630089e-08;1.36839551845766e-11,-9.62186332901419e-11,-1.86838723559981e-09,1.41682565140493e-07,-2.40969935506378e-10,1.44795227500507e-08,1.50160232172833e-08,1.83726709320217e-06,4.83871970080134e-10,1.08289422000795e-05;1.85863403835869e-07,-9.02185456435600e-09,-1.60570718386717e-09,1.28953635107456e-11,2.08343027094044e-06,2.45136883399522e-08,1.87965649591263e-08,4.83871970080144e-10,1.26876382587270e-05,4.47068439843131e-09;-5.42438216435834e-11,-1.70225955710277e-09,-9.80777214816865e-09,6.28326199878922e-07,2.76402410823041e-10,6.25942734117707e-08,6.55169547630093e-08,1.08289422000794e-05,4.47068439843131e-09,9.62156091113891e-05];
P2 = [1.10030294201454e-08,1.05579575282543e-10,9.97702809696801e-11,1.37892438676221e-12,6.09458041655709e-08,2.08247549063383e-09,1.18761253943259e-09,1.37299070778452e-11,1.85801520451730e-07,-4.60235226454027e-11;1.05579575282542e-10,2.35740823623020e-09,2.22590619149526e-10,9.78682146528604e-11,-9.14208721362562e-10,9.04203917836991e-12,-2.21591028288987e-10,-1.02205824182141e-10,-2.49875264787897e-09,-7.03229247819102e-10;9.97702809696800e-11,2.22590619149526e-10,4.23971972933806e-09,1.03195098364587e-10,-8.38614143593735e-11,2.41757239954510e-10,6.34198778028477e-12,-1.65341502730387e-09,-8.20532055466154e-10,-7.59746792731175e-09;1.37892438676220e-12,9.78682146528602e-11,1.03195098364586e-10,1.67649064566640e-08,2.54926416381449e-11,1.75674394992158e-09,3.39827084284188e-09,1.42006449863573e-07,1.17584829583072e-11,6.28305389067777e-07;6.09458041655712e-08,-9.14208721362543e-10,-8.38614143593709e-11,2.54926416381451e-11,5.21970251473266e-07,6.49162352158234e-09,6.38375876663439e-09,-1.08115901683224e-10,2.10470548669362e-06,3.69798970271427e-10;2.08247549063383e-09,9.04203917836987e-12,2.41757239954513e-10,1.75674394992159e-09,6.49162352158229e-09,2.97466000091578e-09,7.47563486345637e-10,1.43391145536680e-08,1.93403619517728e-08,6.24066257610722e-08;1.18761253943259e-09,-2.21591028288981e-10,6.34198778028459e-12,3.39827084284188e-09,6.38375876663440e-09,7.47563486345636e-10,8.29784889553063e-09,1.48406903865617e-08,1.85845780053417e-08,6.44322693648517e-08;1.37299070778450e-11,-1.02205824182149e-10,-1.65341502730389e-09,1.42006449863573e-07,-1.08115901683229e-10,1.43391145536680e-08,1.48406903865616e-08,1.84151322231909e-06,4.66409848782876e-10,1.08409141379069e-05;1.85801520451731e-07,-2.49875264787890e-09,-8.20532055466108e-10,1.17584829583079e-11,2.10470548669361e-06,1.93403619517730e-08,1.85845780053417e-08,4.66409848782888e-10,1.27355735195972e-05,2.41759666180894e-09;-4.60235226454025e-11,-7.03229247819156e-10,-7.59746792731184e-09,6.28305389067779e-07,3.69798970271417e-10,6.24066257610719e-08,6.44322693648510e-08,1.08409141379069e-05,2.41759666180900e-09,9.62627431836760e-05];
P3 = [1.08873630485884e-08,1.40359553846628e-10,9.78494362174164e-11,1.34358921476107e-12,5.96643285383425e-08,3.13463442230853e-09,1.17495138880586e-09,1.29525992481850e-11,1.85863542090372e-07,-5.77537041918607e-11;1.40359553846626e-10,4.85832175949512e-09,2.38348294118382e-10,9.82498541322354e-11,-1.59704585039092e-09,9.52624034519795e-12,2.74286057212659e-10,-9.78836493067052e-11,-8.99227307171912e-09,-1.03888094240289e-09;9.78494362174169e-11,2.38348294118383e-10,2.98141916708516e-09,9.98213818140051e-11,-1.03955006903517e-10,-2.51286913467497e-10,7.71814562234242e-12,-1.20640156566077e-09,-8.61271055845884e-10,-4.01172528896971e-09;1.34358921476107e-12,9.82498541322350e-11,9.98213818140043e-11,1.68027082150807e-08,2.52178501548929e-11,1.76261552783942e-09,2.89786397781491e-09,1.42653017856201e-07,1.51116031025344e-11,6.28262713460619e-07;5.96643285383426e-08,-1.59704585039090e-09,-1.03955006903517e-10,2.52178501548932e-11,5.10754117633962e-07,7.51284448009975e-09,6.18991555441151e-09,-1.66788714560442e-10,2.08342705374926e-06,2.20790468169123e-10;3.13463442230853e-09,9.52624034519816e-12,-2.51286913467500e-10,1.76261552783943e-09,7.51284448009971e-09,1.06977436836224e-08,8.60692186162243e-10,1.45386879488849e-08,2.45828216177058e-08,6.25782890930264e-08;1.17495138880586e-09,2.74286057212666e-10,7.71814562234226e-12,2.89786397781491e-09,6.18991555441152e-09,8.60692186162245e-10,4.42847635141063e-09,1.46067087101100e-08,1.82197598794378e-08,6.29903975871441e-08;1.29525992481849e-11,-9.78836493067124e-11,-1.20640156566077e-09,1.42653017856201e-07,-1.66788714560446e-10,1.45386879488849e-08,1.46067087101100e-08,1.84996804855967e-06,5.18169020242893e-10,1.08647498801816e-05;1.85863542090374e-07,-8.99227307171900e-09,-8.61271055845838e-10,1.51116031025347e-11,2.08342705374927e-06,2.45828216177062e-08,1.82197598794380e-08,5.18169020242900e-10,1.26875103911038e-05,2.58728370175673e-09;-5.77537041918615e-11,-1.03888094240294e-09,-4.01172528896969e-09,6.28262713460616e-07,2.20790468169109e-10,6.25782890930262e-08,6.29903975871440e-08,1.08647498801816e-05,2.58728370175678e-09,9.63605116620703e-05];